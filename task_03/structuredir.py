"""
Скрипт для виведення структури директорії з кольоровим форматуванням.

Функціонал:
- Отримує шлях до директорії з аргументів командного рядка або через введення користувача.
- Перевіряє, чи шлях існує і чи це дійсно директорія.
- Рекурсивно обходить усі підпапки та файли, виводячи їх імена у різних кольорах:
    * Папки — блакитним (Fore.CYAN), де Fore - це колір літер
    * Файли — зеленим (Fore.GREEN)
    * Назва головної директорії — пурпуровим (Fore.MAGENTA)
    * Повідомлення про помилки — червоним (Fore.RED)
- Використовує модулі pathlib, sys і colorama.
"""

from pathlib import Path         # для роботи зі шляхами у файловій системі
from colorama import Fore        # для кольорового виводу у консолі
import sys                       # для читання аргументів командного рядка



#Рекурсивно обходить папки і файли, виводячи структуру з відступами.

def show_dir_structure(path: Path, indent: int = 0):

    for item in path.iterdir():                                 # перебираємо всі елементи (файли й папки) у директорії
        if item.is_dir():                                       # якщо елемент — це папка
            print(" " * indent + f"{Fore.CYAN}{item.name}/")    # виводимо її ім’я блакитним кольором
            show_dir_structure(item, indent + 4)                # рекурсивно обходимо цю підпапку, збільшуючи відступ
        else:                                                   # якщо елемент — файл
            print(" " * indent + f"{Fore.GREEN}{item.name}")    # виводимо ім’я файлу зеленим кольором


# Основна функція: отримує шлях, перевіряє його і викликає обхід директорії.
def main():

    # Якщо шлях передано як аргумент при запуску — беремо його
    if len(sys.argv) > 1:
        directory = Path(sys.argv[1])
    else:
        # Якщо аргумент не передано, запитуємо шлях у користувача вручну
        directory = Path(input("Введіть шлях до директорії: ").strip())

    # Перевіряємо, чи існує шлях
    if not directory.exists():
        print(f"{Fore.RED}Помилка: шлях не існує.")
        return

    # Перевіряємо, чи це дійсно директорія (а не файл)
    if not directory.is_dir():
        print(f"{Fore.RED}Помилка: це не директорія.")
        return

    # Виводимо назву головної директорії пурпуровим кольором
    print(f"{Fore.MAGENTA}{directory.name}/")

    # Викликаємо функцію для рекурсивного обходу і виводу структури
    show_dir_structure(directory)


# Виконуємо main() тільки якщо файл запущено напряму (а не імпортовано)
if __name__ == "__main__":
    main()

# --------------------------------------------------------------------------------
# Приклад запуску в CLI з директорії, де знаходиться скрипт (для macOS / Darwin):
# python3 structuredir.py /Users/cordial/Documents/neo/topic_1
# --------------------------------------------------------------------------------